<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parent Dashboard - Smart Parenting</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --warning: #f72585;
            --danger: #e63946;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --gray: #6c757d;
            --sidebar-width: 250px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: #f5f7fb;
            color: #333;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--dark);
            color: white;
            position: fixed;
            height: 100vh;
            padding: 20px 0;
            z-index: 1000;
            overflow-y: auto;
        }

        .logo {
            padding: 0 20px 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .logo i {
            font-size: 28px;
            color: var(--primary);
            margin-right: 10px;
        }

        .logo h2 {
            font-size: 22px;
            color: white;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            color: #b3b3b3;
            text-decoration: none;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }

        .menu-item:hover, .menu-item.active {
            background: rgba(67, 97, 238, 0.2);
            color: white;
            border-left: 4px solid var(--primary);
        }

        .menu-item i {
            width: 30px;
            font-size: 18px;
        }

        .badge {
            background: var(--danger);
            color: white;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: auto;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left h1 {
            font-size: 24px;
            color: var(--dark);
        }

        .header-left p {
            color: var(--gray);
            font-size: 14px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .notification {
            position: relative;
            cursor: pointer;
        }

        .notification i {
            font-size: 22px;
            color: var(--gray);
        }

        .notification-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            font-size: 12px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        /* Content */
        .content {
            padding: 30px;
        }

        /* Welcome Card */
        .welcome-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .welcome-text h2 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .stat-icon.children { background: #f72585; }
        .stat-icon.health { background: #4361ee; }
        .stat-icon.education { background: #4cc9f0; }
        .stat-icon.expert { background: #7209b7; }

        .stat-info h3 {
            font-size: 28px;
            color: var(--dark);
        }

        .stat-info p {
            color: var(--gray);
            font-size: 14px;
        }

        /* Section Title */
        .section-title {
            font-size: 20px;
            color: var(--dark);
            margin: 40px 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Children Grid */
        .children-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .child-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: transform 0.3s;
        }

        .child-card:hover {
            transform: translateY(-5px);
        }

        .child-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .child-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 600;
        }

        .child-info h4 {
            font-size: 18px;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .child-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            text-align: center;
            margin-top: 20px;
        }

        .stat-item h5 {
            font-size: 20px;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-item p {
            font-size: 12px;
            color: var(--gray);
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 40px;
        }

        .action-btn {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn:hover {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }

        .action-btn i {
            font-size: 28px;
            color: var(--primary);
        }

        .action-btn span {
            font-weight: 500;
            color: var(--dark);
        }

        /* Expert Suggestions */
        .suggestions-list {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }

        .suggestion-item {
            padding: 20px;
            border-bottom: 1px solid #eee;
            transition: background 0.3s;
        }

        .suggestion-item:hover {
            background: #f8f9fa;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .suggestion-header h5 {
            color: var(--dark);
            font-size: 16px;
        }

        .suggestion-date {
            color: var(--gray);
            font-size: 12px;
        }

        .suggestion-content {
            color: var(--gray);
            margin-bottom: 10px;
            font-size: 14px;
        }

        .suggestion-category {
            display: inline-block;
            padding: 4px 12px;
            background: #f8f9fa;
            border-radius: 20px;
            font-size: 12px;
            color: var(--dark);
            margin-right: 10px;
        }

        /* Experts Grid */
        .experts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .expert-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }

        .expert-card:hover {
            transform: translateY(-5px);
        }

        .expert-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .expert-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4cc9f0 0%, #4895ef 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 600;
        }

        .expert-info h4 {
            font-size: 18px;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .expert-specialization {
            color: var(--primary);
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .expert-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #FFD700;
            font-size: 14px;
        }

        .expert-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .expert-stat {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .expert-stat h5 {
            font-size: 20px;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .expert-stat p {
            font-size: 12px;
            color: var(--gray);
        }

        .expert-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .expert-actions .btn {
            flex: 1;
            padding: 10px;
            font-size: 14px;
        }

        .request-expert-btn {
            background: var(--warning);
        }

        .request-expert-btn:hover {
            background: #e1156d;
        }

        /* No Children Message */
        .no-children {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .no-children i {
            font-size: 48px;
            color: #ddd;
            margin-bottom: 20px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: 15px;
            padding: 30px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-lg {
            max-width: 800px;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background: var(--secondary);
        }

        .btn-block {
            width: 100%;
        }

        .btn-secondary {
            background: var(--gray);
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* Health/Education Records */
        .records-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .record-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .record-date {
            color: var(--gray);
            font-size: 14px;
        }

        .record-content {
            color: #333;
            margin-bottom: 10px;
        }

        .record-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .record-actions .btn {
            padding: 5px 15px;
            font-size: 12px;
        }

        /* Profile Edit Form */
        .profile-form {
            max-width: 600px;
            margin: 0 auto;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: 600;
            margin: 0 auto 20px;
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .header {
                padding: 15px;
            }
            
            .content {
                padding: 20px;
            }
            
            .children-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .experts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">
            <i class="fas fa-home"></i>
            <h2>Parent Dashboard</h2>
        </div>
        
        <nav class="sidebar-menu">
            <a href="#" class="menu-item active">
                <i class="fas fa-home"></i> Dashboard
            </a>
            <a href="#" class="menu-item" id="myChildrenBtn">
                <i class="fas fa-child"></i> My Children
            </a>
            <a href="#" class="menu-item" id="expertsBtn">
                <i class="fas fa-user-md"></i> Available Experts
                <span class="badge" id="expertsBadge">0</span>
            </a>
            <a href="#" class="menu-item" id="healthBtn">
                <i class="fas fa-heartbeat"></i> Health Tracker
            </a>
            <a href="#" class="menu-item" id="educationBtn">
                <i class="fas fa-graduation-cap"></i> Education
            </a>
            <a href="#" class="menu-item" id="suggestionsBtn">
                <i class="fas fa-lightbulb"></i> Expert Suggestions
                <span class="badge" id="suggestionsBadge">0</span>
            </a>
            <a href="#" class="menu-item" id="profileBtn">
                <i class="fas fa-user"></i> My Profile
            </a>
            <a href="#" class="menu-item" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1 id="welcomeText">Welcome, Parent!</h1>
                <p>Track and monitor your children's development</p>
            </div>
            
            <div class="header-right">
                <div class="notification" id="notificationBell">
                    <i class="fas fa-bell"></i>
                    <span class="notification-count" id="notificationCount">0</span>
                </div>
                
                <div class="user-profile">
                    <div class="user-avatar" id="userAvatar">P</div>
                    <div>
                        <h4 id="userName">Parent Name</h4>
                        <p>Parent Dashboard</p>
                    </div>
                </div>
            </div>
        </header>

        <!-- Content -->
        <div class="content">
            <!-- Welcome Card -->
            <div class="welcome-card">
                <div class="welcome-text">
                    <h2 id="greetingMessage">Good Morning, Parent!</h2>
                    <p>You have <span id="childrenCount">0</span> children registered and <span id="suggestionsCount">0</span> new suggestions from experts</p>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon children">
                        <i class="fas fa-child"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalChildren">0</h3>
                        <p>Children</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon health">
                        <i class="fas fa-heartbeat"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="healthRecords">0</h3>
                        <p>Health Records</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon education">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="educationRecords">0</h3>
                        <p>Education Records</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon expert">
                        <i class="fas fa-user-md"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="assignedExpert">0</h3>
                        <p>Assigned Expert</p>
                    </div>
                </div>
            </div>

            <!-- My Children -->
            <div class="section-title">
                <h3>My Children</h3>
                <button class="btn" id="addChildBtn">Add Child</button>
            </div>
            
            <div class="children-grid" id="childrenGrid">
                <!-- Children will be loaded here -->
            </div>

            <!-- Available Experts -->
            <div class="section-title">
                <h3>Available Experts</h3>
                <button class="btn" id="refreshExpertsBtn">Refresh</button>
            </div>
            
            <div class="experts-grid" id="expertsGrid">
                <!-- Experts will be loaded here -->
            </div>

            <!-- Quick Actions -->
            <div class="section-title">
                <h3>Quick Actions</h3>
            </div>
            
            <div class="quick-actions">
                <div class="action-btn" id="addHealthRecordBtn">
                    <i class="fas fa-plus-circle"></i>
                    <span>Add Health Record</span>
                </div>
                
                <div class="action-btn" id="addEducationRecordBtn">
                    <i class="fas fa-book-medical"></i>
                    <span>Add Education Record</span>
                </div>
                
                <div class="action-btn" id="viewReportsBtn">
                    <i class="fas fa-chart-line"></i>
                    <span>View Reports</span>
                </div>
                
                <div class="action-btn" id="messageExpertBtn">
                    <i class="fas fa-comment-medical"></i>
                    <span>Message Expert</span>
                </div>
            </div>

            <!-- Recent Suggestions -->
            <div class="section-title">
                <h3>Recent Suggestions from Expert</h3>
                <button class="btn" id="refreshSuggestionsBtn">Refresh</button>
            </div>
            
            <div class="suggestions-list" id="suggestionsList">
                <!-- Suggestions will be loaded here -->
            </div>
        </div>
    </main>

    <!-- Add Child Modal -->
    <div class="modal" id="addChildModal">
        <div class="modal-content">
            <button class="close-modal" id="closeChildModal">&times;</button>
            <h2>Add New Child</h2>
            <form id="addChildForm">
                <div class="form-group">
                    <label>Child's Full Name</label>
                    <input type="text" id="childName" required>
                </div>
                
                <div class="form-group">
                    <label>Date of Birth</label>
                    <input type="date" id="childDob" required>
                </div>
                
                <div class="form-group">
                    <label>Gender</label>
                    <select id="childGender" required>
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Initial Weight (kg)</label>
                    <input type="number" id="childWeight" step="0.1" required>
                </div>
                
                <div class="form-group">
                    <label>Initial Height (cm)</label>
                    <input type="number" id="childHeight" step="0.1" required>
                </div>
                
                <button type="submit" class="btn btn-block">Add Child</button>
            </form>
        </div>
    </div>

    <!-- Add Health Record Modal -->
    <div class="modal" id="addHealthModal">
        <div class="modal-content">
            <button class="close-modal" id="closeHealthModal">&times;</button>
            <h2>Add Health Record</h2>
            <form id="addHealthForm">
                <div class="form-group">
                    <label>Select Child</label>
                    <select id="healthChild" required>
                        <option value="">Select Child</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Weight (kg)</label>
                    <input type="number" id="healthWeight" step="0.1" required>
                </div>
                
                <div class="form-group">
                    <label>Height (cm)</label>
                    <input type="number" id="healthHeight" step="0.1" required>
                </div>
                
                <div class="form-group">
                    <label>Vaccination Status</label>
                    <select id="vaccinationStatus">
                        <option value="up-to-date">Up to Date</option>
                        <option value="pending">Pending</option>
                        <option value="overdue">Overdue</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Health Notes</label>
                    <textarea id="healthNotes" rows="3"></textarea>
                </div>
                
                <button type="submit" class="btn btn-block">Save Health Record</button>
            </form>
        </div>
    </div>

    <!-- Add Education Record Modal -->
    <div class="modal" id="addEducationModal">
        <div class="modal-content">
            <button class="close-modal" id="closeEducationModal">&times;</button>
            <h2>Add Education Record</h2>
            <form id="addEducationForm">
                <div class="form-group">
                    <label>Select Child</label>
                    <select id="educationChild" required>
                        <option value="">Select Child</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Subject</label>
                    <input type="text" id="subject" required placeholder="e.g., Math, English">
                </div>
                
                <div class="form-group">
                    <label>Grade/Marks</label>
                    <input type="text" id="marks" required placeholder="e.g., A+, 85%">
                </div>
                
                <div class="form-group">
                    <label>School/Institute</label>
                    <input type="text" id="school" required>
                </div>
                
                <div class="form-group">
                    <label>Teacher's Name</label>
                    <input type="text" id="teacher">
                </div>
                
                <div class="form-group">
                    <label>Comments</label>
                    <textarea id="educationComments" rows="3"></textarea>
                </div>
                
                <button type="submit" class="btn btn-block">Save Education Record</button>
            </form>
        </div>
    </div>

    <!-- Health Tracker Modal -->
    <div class="modal" id="healthTrackerModal">
        <div class="modal-content modal-lg">
            <button class="close-modal" id="closeHealthTrackerModal">&times;</button>
            <h2>Health Tracker</h2>
            
            <div class="form-group">
                <label>Select Child</label>
                <select id="trackerChild" required>
                    <option value="">Select Child</option>
                </select>
            </div>
            
            <div id="healthTrackerContent">
                <!-- Health data will be loaded here -->
            </div>
            
            <div style="margin-top: 30px;">
                <h3>Add New Health Record</h3>
                <form id="newHealthForm">
                    <div class="form-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="newWeight" step="0.1" required>
                    </div>
                    <div class="form-group">
                        <label>Height (cm)</label>
                        <input type="number" id="newHeight" step="0.1" required>
                    </div>
                    <div class="form-group">
                        <label>Temperature (°C)</label>
                        <input type="number" id="temperature" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Vaccination Status</label>
                        <select id="newVaccination">
                            <option value="up-to-date">Up to Date</option>
                            <option value="pending">Pending</option>
                            <option value="overdue">Overdue</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="newHealthNotes" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-block">Add Health Record</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Education Records Modal -->
    <div class="modal" id="educationTrackerModal">
        <div class="modal-content modal-lg">
            <button class="close-modal" id="closeEducationTrackerModal">&times;</button>
            <h2>Education Records</h2>
            
            <div class="form-group">
                <label>Select Child</label>
                <select id="educationTrackerChild" required>
                    <option value="">Select Child</option>
                </select>
            </div>
            
            <div id="educationTrackerContent">
                <!-- Education data will be loaded here -->
            </div>
            
            <div style="margin-top: 30px;">
                <h3>Add New Education Record</h3>
                <form id="newEducationForm">
                    <div class="form-group">
                        <label>Subject</label>
                        <input type="text" id="newSubject" required placeholder="e.g., Math, English">
                    </div>
                    <div class="form-group">
                        <label>Grade/Marks</label>
                        <input type="text" id="newMarks" required placeholder="e.g., A+, 85%">
                    </div>
                    <div class="form-group">
                        <label>School/Institute</label>
                        <input type="text" id="newSchool" required>
                    </div>
                    <div class="form-group">
                        <label>Teacher's Name</label>
                        <input type="text" id="newTeacher">
                    </div>
                    <div class="form-group">
                        <label>Comments</label>
                        <textarea id="newEducationComments" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-block">Add Education Record</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal" id="profileModal">
        <div class="modal-content">
            <button class="close-modal" id="closeProfileModal">&times;</button>
            <h2>My Profile</h2>
            
            <div class="profile-avatar" id="profileAvatar">P</div>
            
            <form id="profileForm" class="profile-form">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="fullName" required>
                </div>
                
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="email" required>
                </div>
                
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" id="phone">
                </div>
                
                <div class="form-group">
                    <label>Address</label>
                    <textarea id="address" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Emergency Contact</label>
                    <input type="text" id="emergencyContact">
                </div>
                
                <button type="submit" class="btn btn-block">Update Profile</button>
            </form>
        </div>
    </div>

    <!-- Expert Details Modal -->
    <div class="modal" id="expertDetailsModal">
        <div class="modal-content">
            <button class="close-modal" id="closeExpertModal">&times;</button>
            <h2>Expert Details</h2>
            <div id="expertDetailsContent">
                <!-- Expert details will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        class ParentDashboard {
            constructor() {
                this.currentUser = null;
                this.children = [];
                this.assignments = [];
                this.expert = null;
                this.initialize();
            }
            
            initialize() {
                this.checkAuthentication();
                this.loadUserData();
                this.loadChildren();
                this.loadAssignments();
                this.setupEventListeners();
                this.updateStats();
                this.loadSuggestions();
                this.loadExperts();
            }
            
            checkAuthentication() {
                const token = localStorage.getItem('token');
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                
                if (!token || user.role !== 'parent') {
                    window.location.href = 'login.html';
                    return;
                }
                
                this.currentUser = user;
            }
            
            loadUserData() {
                document.getElementById('userName').textContent = this.currentUser.name;
                document.getElementById('userAvatar').textContent = this.currentUser.name.charAt(0).toUpperCase();
                document.getElementById('welcomeText').textContent = `Welcome, ${this.currentUser.name.split(' ')[0]}!`;
                
                // Set greeting based on time
                const hour = new Date().getHours();
                let greeting = 'Good Morning, Parent!';
                if (hour >= 12 && hour < 17) greeting = 'Good Afternoon, Parent!';
                if (hour >= 17) greeting = 'Good Evening, Parent!';
                document.getElementById('greetingMessage').textContent = greeting;
            }
            
            loadChildren() {
                this.children = JSON.parse(localStorage.getItem('children') || '[]')
                    .filter(child => child.parentId === this.currentUser.id);
                
                document.getElementById('childrenCount').textContent = this.children.length;
                document.getElementById('totalChildren').textContent = this.children.length;
                
                this.updateChildrenGrid();
            }
            
            updateChildrenGrid() {
                const grid = document.getElementById('childrenGrid');
                
                if (this.children.length === 0) {
                    grid.innerHTML = `
                        <div class="no-children">
                            <i class="fas fa-child"></i>
                            <h3 style="color: var(--gray); margin-bottom: 10px;">No Children Added Yet</h3>
                            <p style="color: var(--gray); margin-bottom: 20px;">Add your first child to start tracking their development</p>
                            <button class="btn" id="addFirstChildBtn">Add Your First Child</button>
                        </div>
                    `;
                    
                    document.getElementById('addFirstChildBtn').addEventListener('click', () => {
                        this.showAddChildModal();
                    });
                    
                    return;
                }
                
                grid.innerHTML = this.children.map(child => {
                    const age = this.calculateAge(child.dob);
                    const healthScore = this.calculateHealthScore(child.id);
                    const educationScore = this.calculateEducationScore(child.id);
                    
                    return `
                        <div class="child-card" onclick="window.parentDashboard.viewChildProfile('${child.id}')">
                            <div class="child-header">
                                <div class="child-avatar">${child.name.charAt(0)}</div>
                                <div class="child-info">
                                    <h4>${child.name}</h4>
                                    <p>${age} years • ${child.gender}</p>
                                    <small style="color: var(--gray);">DOB: ${new Date(child.dob).toLocaleDateString()}</small>
                                </div>
                            </div>
                            <div class="child-stats">
                                <div class="stat-item">
                                    <h5>${healthScore}%</h5>
                                    <p>Health</p>
                                </div>
                                <div class="stat-item">
                                    <h5>${educationScore}%</h5>
                                    <p>Education</p>
                                </div>
                                <div class="stat-item">
                                    <h5>${this.getActivityCount(child.id)}</h5>
                                    <p>Activities</p>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            calculateAge(dob) {
                const birthDate = new Date(dob);
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                
                return age;
            }
            
            calculateHealthScore(childId) {
                const records = JSON.parse(localStorage.getItem('healthRecords') || '[]')
                    .filter(record => record.childId === childId);
                
                if (records.length === 0) return 0;
                
                const latest = records[records.length - 1];
                const weight = latest.weight || 0;
                const height = latest.height || 1;
                
                const bmi = weight / ((height/100) * (height/100));
                let score = 85;
                
                if (bmi < 18.5) score = 70;
                else if (bmi >= 18.5 && bmi <= 24.9) score = 95;
                else if (bmi > 24.9) score = 75;
                
                return score;
            }
            
            calculateEducationScore(childId) {
                const records = JSON.parse(localStorage.getItem('educationRecords') || '[]')
                    .filter(record => record.childId === childId);
                
                if (records.length === 0) return 0;
                
                const total = records.reduce((sum, record) => {
                    let marks = 0;
                    const marksStr = record.marks || '0';
                    
                    // Parse marks from string (e.g., "85%" or "A+")
                    if (marksStr.includes('%')) {
                        marks = parseInt(marksStr) || 0;
                    } else if (marksStr.includes('A')) {
                        marks = 90; // A grade
                    } else if (marksStr.includes('B')) {
                        marks = 80; // B grade
                    } else if (marksStr.includes('C')) {
                        marks = 70; // C grade
                    } else {
                        marks = parseInt(marksStr) || 0;
                    }
                    
                    return sum + (marks > 100 ? 100 : marks);
                }, 0);
                
                return Math.round(total / records.length);
            }
            
            getActivityCount(childId) {
                const activities = JSON.parse(localStorage.getItem('activities') || '[]')
                    .filter(activity => activity.childId === childId);
                return activities.length;
            }
            
            loadAssignments() {
                this.assignments = JSON.parse(localStorage.getItem('assignments') || '[]')
                    .filter(a => a.parentId === this.currentUser.id);
                
                if (this.assignments.length > 0) {
                    const assignment = this.assignments[0];
                    const users = JSON.parse(localStorage.getItem('users') || '[]');
                    this.expert = users.find(u => u.id === assignment.expertId);
                    
                    if (this.expert) {
                        document.getElementById('assignedExpert').textContent = '1';
                    }
                }
            }
            
            updateStats() {
                // Count health records
                let healthCount = 0;
                this.children.forEach(child => {
                    const records = JSON.parse(localStorage.getItem('healthRecords') || '[]')
                        .filter(record => record.childId === child.id);
                    healthCount += records.length;
                });
                document.getElementById('healthRecords').textContent = healthCount;
                
                // Count education records
                let educationCount = 0;
                this.children.forEach(child => {
                    const records = JSON.parse(localStorage.getItem('educationRecords') || '[]')
                        .filter(record => record.childId === child.id);
                    educationCount += records.length;
                });
                document.getElementById('educationRecords').textContent = educationCount;
                
                // Update notification count (new suggestions)
                const suggestions = JSON.parse(localStorage.getItem('suggestions') || '[]')
                    .filter(s => this.children.some(c => c.id === s.childId) && s.status === 'new');
                document.getElementById('notificationCount').textContent = suggestions.length;
                document.getElementById('suggestionsCount').textContent = suggestions.length;
                document.getElementById('suggestionsBadge').textContent = suggestions.length;
            }
            
            loadSuggestions() {
                const suggestions = JSON.parse(localStorage.getItem('suggestions') || '[]')
                    .filter(s => this.children.some(c => c.id === s.childId))
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 5);
                
                const container = document.getElementById('suggestionsList');
                
                if (suggestions.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--gray);">
                            <i class="fas fa-lightbulb" style="font-size: 24px; margin-bottom: 10px; display: block;"></i>
                            No suggestions from expert yet
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = suggestions.map(suggestion => {
                    const child = this.children.find(c => c.id === suggestion.childId);
                    const expert = JSON.parse(localStorage.getItem('users') || '[]')
                        .find(u => u.id === suggestion.expertId);
                    
                    return `
                        <div class="suggestion-item">
                            <div class="suggestion-header">
                                <h5>${suggestion.title}</h5>
                                <span class="suggestion-date">${new Date(suggestion.date).toLocaleDateString()}</span>
                            </div>
                            <div class="suggestion-content">
                                ${suggestion.details}
                            </div>
                            <div>
                                <span class="suggestion-category">${suggestion.category}</span>
                                <small style="color: var(--gray);">
                                    For: ${child?.name || 'Unknown'} | By: ${expert?.name || 'Expert'}
                                </small>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            loadExperts() {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const verifiedExperts = users.filter(u => u.role === 'expert' && u.status === 'verified');
                
                document.getElementById('expertsBadge').textContent = verifiedExperts.length;
                
                const expertsGrid = document.getElementById('expertsGrid');
                
                if (verifiedExperts.length === 0) {
                    expertsGrid.innerHTML = `
                        <div style="grid-column: 1/-1; text-align: center; padding: 40px; background: white; border-radius: 15px;">
                            <i class="fas fa-user-md" style="font-size: 48px; color: #ddd; margin-bottom: 20px;"></i>
                            <h3 style="color: var(--gray); margin-bottom: 10px;">No Experts Available</h3>
                            <p style="color: var(--gray);">Check back later for available experts</p>
                        </div>
                    `;
                    return;
                }
                
                expertsGrid.innerHTML = verifiedExperts.map(expert => {
                    // Count expert's completed cases
                    const suggestions = JSON.parse(localStorage.getItem('suggestions') || '[]')
                        .filter(s => s.expertId === expert.id);
                    const completedCases = suggestions.filter(s => s.status === 'implemented').length;
                    
                    // Get expert's rating
                    const ratings = JSON.parse(localStorage.getItem('ratings') || '[]')
                        .filter(r => r.expertId === expert.id);
                    const avgRating = ratings.length > 0 ? 
                        (ratings.reduce((sum, r) => sum + r.rating, 0) / ratings.length).toFixed(1) : '4.5';
                    
                    // Check if already assigned to this parent
                    const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
                    const isAssigned = assignments.some(a => 
                        a.parentId === this.currentUser.id && a.expertId === expert.id
                    );
                    
                    return `
                        <div class="expert-card">
                            <div class="expert-header">
                                <div class="expert-avatar">${expert.name.charAt(0)}</div>
                                <div class="expert-info">
                                    <h4>${expert.name}</h4>
                                    <div class="expert-specialization">${expert.specialization || 'Child Development Expert'}</div>
                                    <div class="expert-rating">
                                        <i class="fas fa-star"></i>
                                        <span>${avgRating}</span>
                                        <span style="color: var(--gray); font-size: 12px; margin-left: 5px;">(${ratings.length} ratings)</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="expert-stats">
                                <div class="expert-stat">
                                    <h5>${expert.experience || '5'}+</h5>
                                    <p>Years Experience</p>
                                </div>
                                <div class="expert-stat">
                                    <h5>${completedCases}</h5>
                                    <p>Cases Completed</p>
                                </div>
                            </div>
                            
                            <p style="color: var(--gray); font-size: 14px; margin-top: 15px;">
                                ${expert.qualifications ? expert.qualifications.substring(0, 100) + '...' : 'Qualified child development expert'}
                            </p>
                            
                            <div class="expert-actions">
                                ${isAssigned ? `
                                    <button class="btn" style="background: #28a745;" onclick="window.parentDashboard.messageExpert('${expert.id}')">
                                        <i class="fas fa-comment"></i> Message
                                    </button>
                                ` : `
                                    <button class="btn request-expert-btn" onclick="window.parentDashboard.requestExpert('${expert.id}')">
                                        <i class="fas fa-user-plus"></i> Request
                                    </button>
                                `}
                                <button class="btn" onclick="window.parentDashboard.viewExpertDetails('${expert.id}')">
                                    <i class="fas fa-eye"></i> View
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            requestExpert(expertId) {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const expert = users.find(u => u.id === expertId);
                
                if (!expert) {
                    alert('Expert not found');
                    return;
                }
                
                if (confirm(`Request ${expert.name} as your child development expert?`)) {
                    // Create assignment request
                    const request = {
                        id: 'req_' + Date.now(),
                        parentId: this.currentUser.id,
                        parentName: this.currentUser.name,
                        expertId: expert.id,
                        expertName: expert.name,
                        status: 'pending',
                        requestedAt: new Date().toISOString()
                    };
                    
                    // Save request
                    let requests = JSON.parse(localStorage.getItem('expert_requests') || '[]');
                    requests.push(request);
                    localStorage.setItem('expert_requests', JSON.stringify(requests));
                    
                    // Log activity
                    this.logActivity({
                        userId: this.currentUser.id,
                        userName: this.currentUser.name,
                        action: 'Requested expert',
                        type: 'expert',
                        details: `Requested expert ${expert.name}`
                    });
                    
                    alert(`Request sent to ${expert.name}! Admin will review and assign the expert to you.`);
                    
                    // Refresh experts list
                    this.loadExperts();
                }
            }
            
            messageExpert(expertId) {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const expert = users.find(u => u.id === expertId);
                
                if (!expert) {
                    alert('Expert not found');
                    return;
                }
                
                alert(`Chat feature with ${expert.name} coming soon!`);
            }
            
            viewExpertDetails(expertId) {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const expert = users.find(u => u.id === expertId);
                
                if (!expert) {
                    alert('Expert not found');
                    return;
                }
                
                // Get expert's stats
                const suggestions = JSON.parse(localStorage.getItem('suggestions') || '[]')
                    .filter(s => s.expertId === expert.id);
                const ratings = JSON.parse(localStorage.getItem('ratings') || '[]')
                    .filter(r => r.expertId === expert.id);
                const avgRating = ratings.length > 0 ? 
                    (ratings.reduce((sum, r) => sum + r.rating, 0) / ratings.length).toFixed(1) : 'Not rated';
                
                const expertDetails = document.getElementById('expertDetailsContent');
                expertDetails.innerHTML = `
                    <div style="text-align: center; margin-bottom: 30px;">
                        <div style="width: 100px; height: 100px; background: linear-gradient(135deg, #4cc9f0 0%, #4895ef 100%); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 36px; font-weight: 600; margin: 0 auto 20px;">
                            ${expert.name.charAt(0)}
                        </div>
                        <h3>${expert.name}</h3>
                        <p style="color: var(--primary); margin-bottom: 10px;">${expert.specialization || 'Child Development Expert'}</p>
                        <div style="color: var(--gray); font-size: 14px;">
                            <i class="fas fa-star" style="color: gold;"></i> ${avgRating} Rating • ${ratings.length} reviews
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0;">
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: 600; color: var(--primary);">${expert.experience || '5'}+</div>
                            <div style="font-size: 12px; color: var(--gray);">Years Experience</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: 600; color: var(--primary);">${suggestions.length}</div>
                            <div style="font-size: 12px; color: var(--gray);">Total Suggestions</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: 600; color: var(--primary);">${suggestions.filter(s => s.status === 'implemented').length}</div>
                            <div style="font-size: 12px; color: var(--gray);">Implemented</div>
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <h4 style="color: var(--dark); margin-bottom: 10px;">Qualifications</h4>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; color: var(--gray);">
                            ${expert.qualifications || 'No qualifications provided'}
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <h4 style="color: var(--dark); margin-bottom: 10px;">Contact Information</h4>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <i class="fas fa-envelope" style="color: var(--gray);"></i>
                                <span>${expert.email}</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-phone" style="color: var(--gray);"></i>
                                <span>${expert.phone || 'Not provided'}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 30px;">
                        <button class="btn" style="flex: 1;" onclick="window.parentDashboard.requestExpert('${expert.id}')">
                            <i class="fas fa-user-plus"></i> Request Expert
                        </button>
                        <button class="btn btn-secondary" style="flex: 1;" onclick="document.getElementById('expertDetailsModal').classList.remove('active')">
                            Close
                        </button>
                    </div>
                `;
                
                document.getElementById('expertDetailsModal').classList.add('active');
            }
            
            // ===========================================
            // NEW FUNCTIONS FOR PROFILE, EDUCATION, HEALTH
            // ===========================================
            
            showProfileModal() {
                // Load current user data
                document.getElementById('fullName').value = this.currentUser.name || '';
                document.getElementById('email').value = this.currentUser.email || '';
                document.getElementById('phone').value = this.currentUser.phone || '';
                document.getElementById('address').value = this.currentUser.address || '';
                document.getElementById('emergencyContact').value = this.currentUser.emergencyContact || '';
                document.getElementById('profileAvatar').textContent = (this.currentUser.name || 'P').charAt(0).toUpperCase();
                
                document.getElementById('profileModal').classList.add('active');
            }
            
            showHealthTrackerModal() {
                if (this.children.length === 0) {
                    alert('Please add a child first');
                    return;
                }
                
                // Populate child dropdown
                const select = document.getElementById('trackerChild');
                select.innerHTML = '<option value="">Select Child</option>' +
                    this.children.map(child => 
                        `<option value="${child.id}">${child.name}</option>`
                    ).join('');
                
                // Load health data for first child if available
                if (this.children.length > 0) {
                    select.value = this.children[0].id;
                    this.loadChildHealthData(this.children[0].id);
                }
                
                document.getElementById('healthTrackerModal').classList.add('active');
            }
            
            loadChildHealthData(childId) {
                const records = JSON.parse(localStorage.getItem('healthRecords') || '[]')
                    .filter(record => record.childId === childId)
                    .sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const child = this.children.find(c => c.id === childId);
                
                let content = '';
                
                if (records.length === 0) {
                    content = `
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h3>${child?.name}'s Health History</h3>
                            <p style="color: var(--gray);">No health records found. Add the first record below.</p>
                        </div>
                    `;
                } else {
                    content = `
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h3>${child?.name}'s Health History</h3>
                            <div class="records-grid" style="margin-top: 15px;">
                                ${records.slice(0, 5).map(record => `
                                    <div class="record-card">
                                        <div class="record-header">
                                            <strong>${new Date(record.date).toLocaleDateString()}</strong>
                                            <span class="record-date">${record.recordedBy || 'Parent'}</span>
                                        </div>
                                        <div class="record-content">
                                            <div>Weight: <strong>${record.weight} kg</strong></div>
                                            <div>Height: <strong>${record.height} cm</strong></div>
                                            ${record.temperature ? `<div>Temperature: <strong>${record.temperature} °C</strong></div>` : ''}
                                            <div>Vaccination: <strong>${record.vaccination}</strong></div>
                                            ${record.notes ? `<div>Notes: ${record.notes}</div>` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                
                document.getElementById('healthTrackerContent').innerHTML = content;
            }
            
            addNewHealthRecord() {
                const childSelect = document.getElementById('trackerChild');
                if (!childSelect.value) {
                    alert('Please select a child first');
                    return;
                }
                
                const record = {
                    id: 'health_' + Date.now(),
                    childId: childSelect.value,
                    weight: parseFloat(document.getElementById('newWeight').value),
                    height: parseFloat(document.getElementById('newHeight').value),
                    temperature: document.getElementById('temperature').value || null,
                    vaccination: document.getElementById('newVaccination').value,
                    notes: document.getElementById('newHealthNotes').value,
                    date: new Date().toISOString(),
                    recordedBy: this.currentUser.name
                };
                
                let records = JSON.parse(localStorage.getItem('healthRecords') || '[]');
                records.push(record);
                localStorage.setItem('healthRecords', JSON.stringify(records));
                
                const child = this.children.find(c => c.id === record.childId);
                this.logActivity({
                    userId: this.currentUser.id,
                    userName: this.currentUser.name,
                    action: 'Added health record',
                    type: 'health',
                    details: `Added health record for ${child?.name || 'child'}`
                });
                
                alert('Health record added successfully!');
                
                // Reset form and reload data
                document.getElementById('newHealthForm').reset();
                this.loadChildHealthData(childSelect.value);
                this.updateStats();
            }
            
            showEducationTrackerModal() {
                if (this.children.length === 0) {
                    alert('Please add a child first');
                    return;
                }
                
                // Populate child dropdown
                const select = document.getElementById('educationTrackerChild');
                select.innerHTML = '<option value="">Select Child</option>' +
                    this.children.map(child => 
                        `<option value="${child.id}">${child.name}</option>`
                    ).join('');
                
                // Load education data for first child if available
                if (this.children.length > 0) {
                    select.value = this.children[0].id;
                    this.loadChildEducationData(this.children[0].id);
                }
                
                document.getElementById('educationTrackerModal').classList.add('active');
            }
            
            loadChildEducationData(childId) {
                const records = JSON.parse(localStorage.getItem('educationRecords') || '[]')
                    .filter(record => record.childId === childId)
                    .sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const child = this.children.find(c => c.id === childId);
                
                let content = '';
                
                if (records.length === 0) {
                    content = `
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h3>${child?.name}'s Education History</h3>
                            <p style="color: var(--gray);">No education records found. Add the first record below.</p>
                        </div>
                    `;
                } else {
                    content = `
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h3>${child?.name}'s Education History</h3>
                            <div class="records-grid" style="margin-top: 15px;">
                                ${records.slice(0, 5).map(record => `
                                    <div class="record-card">
                                        <div class="record-header">
                                            <strong>${record.subject}</strong>
                                            <span class="record-date">${new Date(record.date).toLocaleDateString()}</span>
                                        </div>
                                        <div class="record-content">
                                            <div>Grade/Marks: <strong>${record.marks}</strong></div>
                                            <div>School: ${record.school}</div>
                                            ${record.teacher ? `<div>Teacher: ${record.teacher}</div>` : ''}
                                            ${record.comments ? `<div>Comments: ${record.comments}</div>` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                
                document.getElementById('educationTrackerContent').innerHTML = content;
            }
            
            addNewEducationRecord() {
                const childSelect = document.getElementById('educationTrackerChild');
                if (!childSelect.value) {
                    alert('Please select a child first');
                    return;
                }
                
                const record = {
                    id: 'edu_' + Date.now(),
                    childId: childSelect.value,
                    subject: document.getElementById('newSubject').value,
                    marks: document.getElementById('newMarks').value,
                    school: document.getElementById('newSchool').value,
                    teacher: document.getElementById('newTeacher').value,
                    comments: document.getElementById('newEducationComments').value,
                    date: new Date().toISOString(),
                    addedBy: this.currentUser.name
                };
                
                let records = JSON.parse(localStorage.getItem('educationRecords') || '[]');
                records.push(record);
                localStorage.setItem('educationRecords', JSON.stringify(records));
                
                const child = this.children.find(c => c.id === record.childId);
                this.logActivity({
                    userId: this.currentUser.id,
                    userName: this.currentUser.name,
                    action: 'Added education record',
                    type: 'education',
                    details: `Added education record for ${child?.name || 'child'}`
                });
                
                alert('Education record added successfully!');
                
                // Reset form and reload data
                document.getElementById('newEducationForm').reset();
                this.loadChildEducationData(childSelect.value);
                this.updateStats();
            }
            
            // ===========================================
            // END OF NEW FUNCTIONS
            // ===========================================
            
            setupEventListeners() {
                // Menu items
                document.getElementById('myChildrenBtn').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showMyChildren();
                });
                
                document.getElementById('expertsBtn').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showExperts();
                });
                
                // UPDATED: Health Tracker
                document.getElementById('healthBtn').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showHealthTrackerModal(); // Updated from alert to actual function
                });
                
                // UPDATED: Education Tracker
                document.getElementById('educationBtn').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showEducationTrackerModal(); // Updated from alert to actual function
                });
                
                document.getElementById('suggestionsBtn').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showSuggestions();
                });
                
                // UPDATED: Profile
                document.getElementById('profileBtn').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showProfileModal(); // Updated from redirect to modal
                });
                
                document.getElementById('logoutBtn').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.logout();
                });
                
                // Action buttons
                document.getElementById('addChildBtn').addEventListener('click', () => {
                    this.showAddChildModal();
                });
                
                document.getElementById('addHealthRecordBtn').addEventListener('click', () => {
                    this.showAddHealthModal();
                });
                
                document.getElementById('addEducationRecordBtn').addEventListener('click', () => {
                    this.showAddEducationModal();
                });
                
                document.getElementById('viewReportsBtn').addEventListener('click', () => {
                    this.viewReports();
                });
                
                document.getElementById('messageExpertBtn').addEventListener('click', () => {
                    this.messageExpertBtnClick();
                });
                
                document.getElementById('refreshSuggestionsBtn').addEventListener('click', () => {
                    this.loadSuggestions();
                    alert('Suggestions refreshed!');
                });
                
                document.getElementById('refreshExpertsBtn').addEventListener('click', () => {
                    this.loadExperts();
                    alert('Experts list refreshed!');
                });
                
                // Modal close buttons
                document.getElementById('closeChildModal').addEventListener('click', () => {
                    document.getElementById('addChildModal').classList.remove('active');
                });
                
                document.getElementById('closeHealthModal').addEventListener('click', () => {
                    document.getElementById('addHealthModal').classList.remove('active');
                });
                
                document.getElementById('closeEducationModal').addEventListener('click', () => {
                    document.getElementById('addEducationModal').classList.remove('active');
                });
                
                document.getElementById('closeHealthTrackerModal').addEventListener('click', () => {
                    document.getElementById('healthTrackerModal').classList.remove('active');
                });
                
                document.getElementById('closeEducationTrackerModal').addEventListener('click', () => {
                    document.getElementById('educationTrackerModal').classList.remove('active');
                });
                
                document.getElementById('closeProfileModal').addEventListener('click', () => {
                    document.getElementById('profileModal').classList.remove('active');
                });
                
                document.getElementById('closeExpertModal').addEventListener('click', () => {
                    document.getElementById('expertDetailsModal').classList.remove('active');
                });
                
                // Form submissions
                document.getElementById('addChildForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addChild();
                });
                
                document.getElementById('addHealthForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addHealthRecord();
                });
                
                document.getElementById('addEducationForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addEducationRecord();
                });
                
                // NEW: Health Tracker Form
                document.getElementById('newHealthForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addNewHealthRecord();
                });
                
                // NEW: Education Tracker Form
                document.getElementById('newEducationForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addNewEducationRecord();
                });
                
                // NEW: Profile Form
                document.getElementById('profileForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.updateProfile();
                });
                
                // Child select change events
                document.getElementById('trackerChild').addEventListener('change', (e) => {
                    if (e.target.value) {
                        this.loadChildHealthData(e.target.value);
                    }
                });
                
                document.getElementById('educationTrackerChild').addEventListener('change', (e) => {
                    if (e.target.value) {
                        this.loadChildEducationData(e.target.value);
                    }
                });
                
                // Close modals when clicking outside
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.classList.remove('active');
                        }
                    });
                });
            }
            
            showAddChildModal() {
                document.getElementById('addChildModal').classList.add('active');
                document.getElementById('childName').focus();
                // Set default date to 5 years ago
                const defaultDate = new Date();
                defaultDate.setFullYear(defaultDate.getFullYear() - 5);
                document.getElementById('childDob').value = defaultDate.toISOString().split('T')[0];
            }
            
            showAddHealthModal() {
                if (this.children.length === 0) {
                    alert('Please add a child first');
                    return;
                }
                
                const select = document.getElementById('healthChild');
                select.innerHTML = '<option value="">Select Child</option>' +
                    this.children.map(child => 
                        `<option value="${child.id}">${child.name}</option>`
                    ).join('');
                
                document.getElementById('addHealthModal').classList.add('active');
            }
            
            showAddEducationModal() {
                if (this.children.length === 0) {
                    alert('Please add a child first');
                    return;
                }
                
                const select = document.getElementById('educationChild');
                select.innerHTML = '<option value="">Select Child</option>' +
                    this.children.map(child => 
                        `<option value="${child.id}">${child.name}</option>`
                    ).join('');
                
                document.getElementById('addEducationModal').classList.add('active');
            }
            
            addChild() {
                const child = {
                    id: 'child_' + Date.now(),
                    parentId: this.currentUser.id,
                    name: document.getElementById('childName').value,
                    dob: document.getElementById('childDob').value,
                    gender: document.getElementById('childGender').value,
                    weight: document.getElementById('childWeight').value,
                    height: document.getElementById('childHeight').value,
                    createdAt: new Date().toISOString()
                };
                
                let children = JSON.parse(localStorage.getItem('children') || '[]');
                children.push(child);
                localStorage.setItem('children', JSON.stringify(children));
                
                // Log activity
                this.logActivity({
                    userId: this.currentUser.id,
                    userName: this.currentUser.name,
                    action: 'Added new child',
                    type: 'child_management',
                    details: `Added child ${child.name}`
                });
                
                alert('Child added successfully!');
                document.getElementById('addChildModal').classList.remove('active');
                document.getElementById('addChildForm').reset();
                
                // Refresh data
                this.loadChildren();
                this.updateStats();
            }
            
            addHealthRecord() {
                const record = {
                    id: 'health_' + Date.now(),
                    childId: document.getElementById('healthChild').value,
                    weight: parseFloat(document.getElementById('healthWeight').value),
                    height: parseFloat(document.getElementById('healthHeight').value),
                    vaccination: document.getElementById('vaccinationStatus').value,
                    notes: document.getElementById('healthNotes').value,
                    date: new Date().toISOString(),
                    recordedBy: this.currentUser.name
                };
                
                let records = JSON.parse(localStorage.getItem('healthRecords') || '[]');
                records.push(record);
                localStorage.setItem('healthRecords', JSON.stringify(records));
                
                // Log activity
                const child = this.children.find(c => c.id === record.childId);
                this.logActivity({
                    userId: this.currentUser.id,
                    userName: this.currentUser.name,
                    action: 'Added health record',
                    type: 'health',
                    details: `Added health record for ${child?.name || 'child'}`
                });
                
                alert('Health record added successfully!');
                document.getElementById('addHealthModal').classList.remove('active');
                document.getElementById('addHealthForm').reset();
                
                // Refresh data
                this.updateStats();
            }
            
            addEducationRecord() {
                const record = {
                    id: 'edu_' + Date.now(),
                    childId: document.getElementById('educationChild').value,
                    subject: document.getElementById('subject').value,
                    marks: document.getElementById('marks').value,
                    school: document.getElementById('school').value,
                    teacher: document.getElementById('teacher').value,
                    comments: document.getElementById('educationComments').value,
                    date: new Date().toISOString(),
                    addedBy: this.currentUser.name
                };
                
                let records = JSON.parse(localStorage.getItem('educationRecords') || '[]');
                records.push(record);
                localStorage.setItem('educationRecords', JSON.stringify(records));
                
                const child = this.children.find(c => c.id === record.childId);
                this.logActivity({
                    userId: this.currentUser.id,
                    userName: this.currentUser.name,
                    action: 'Added education record',
                    type: 'education',
                    details: `Added education record for ${child?.name || 'child'}`
                });
                
                alert('Education record added successfully!');
                document.getElementById('addEducationModal').classList.remove('active');
                document.getElementById('addEducationForm').reset();
                
                // Refresh data
                this.updateStats();
            }
            
            updateProfile() {
                // Update user data
                this.currentUser.name = document.getElementById('fullName').value;
                this.currentUser.email = document.getElementById('email').value;
                this.currentUser.phone = document.getElementById('phone').value;
                this.currentUser.address = document.getElementById('address').value;
                this.currentUser.emergencyContact = document.getElementById('emergencyContact').value;
                
                // Save to localStorage
                localStorage.setItem('user', JSON.stringify(this.currentUser));
                
                // Update UI
                this.loadUserData();
                
                alert('Profile updated successfully!');
                document.getElementById('profileModal').classList.remove('active');
                
                // Log activity
                this.logActivity({
                    userId: this.currentUser.id,
                    userName: this.currentUser.name,
                    action: 'Updated profile',
                    type: 'profile',
                    details: 'Updated personal information'
                });
            }
            
            viewChildProfile(childId) {
                localStorage.setItem('selectedChildId', childId);
                window.location.href = 'child-profile.html';
            }
            
            showMyChildren() {
                document.getElementById('myChildrenBtn').classList.add('active');
                // Scroll to children grid
                document.getElementById('childrenGrid').scrollIntoView({ behavior: 'smooth' });
            }
            
            showExperts() {
                document.getElementById('expertsBtn').classList.add('active');
                // Scroll to experts grid
                document.getElementById('expertsGrid').scrollIntoView({ behavior: 'smooth' });
            }
            
            showSuggestions() {
                document.getElementById('suggestionsBtn').classList.add('active');
                // Scroll to suggestions
                document.getElementById('suggestionsList').scrollIntoView({ behavior: 'smooth' });
            }
            
            messageExpertBtnClick() {
                if (!this.expert) {
                    alert('No expert assigned to you yet. Please request an expert first.');
                    return;
                }
                
                alert(`Chat feature with ${this.expert.name} coming soon!`);
            }
            
            viewReports() {
                if (this.children.length === 0) {
                    alert('Add children first to generate reports');
                    return;
                }
                
                const reportData = `
                    <h3>Parent Report - ${this.currentUser.name}</h3>
                    <p><strong>Generated:</strong> ${new Date().toLocaleString()}</p>
                    <p><strong>Total Children:</strong> ${this.children.length}</p>
                    
                    <h4>Children Summary:</h4>
                    <ul>
                        ${this.children.map(c => {
                            const age = this.calculateAge(c.dob);
                            return `<li>${c.name} (${age} years, ${c.gender})</li>`;
                        }).join('')}
                    </ul>
                    
                    ${this.expert ? `
                        <h4>Assigned Expert:</h4>
                        <p>${this.expert.name} - ${this.expert.specialization}</p>
                    ` : ''}
                `;
                
                // Create a new window with the report
                const reportWindow = window.open('', '_blank');
                reportWindow.document.write(`
                    <html>
                    <head>
                        <title>Parent Report</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; }
                            h3, h4 { color: #333; }
                            p { margin: 10px 0; }
                            ul { margin-left: 20px; }
                        </style>
                    </head>
                    <body>
                        ${reportData}
                        <br><br>
                        <button onclick="window.print()">Print Report</button>
                    </body>
                    </html>
                `);
            }
            
            logActivity(activity) {
                const log = {
                    ...activity,
                    timestamp: new Date().toISOString(),
                    id: 'log_' + Date.now()
                };
                
                let logs = JSON.parse(localStorage.getItem('activities_log') || '[]');
                logs.push(log);
                localStorage.setItem('activities_log', JSON.stringify(logs));
            }
            
            logout() {
                if (confirm('Are you sure you want to logout?')) {
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                    window.location.href = 'login.html';
                }
            }
        }
        
        // Initialize parent dashboard
        document.addEventListener('DOMContentLoaded', () => {
            window.parentDashboard = new ParentDashboard();
        });
    </script>
</body>
</html>